---
name: i18n-analyze
description: プロジェクトの国際化（i18n）状況を分析し、翻訳カバレッジ、未翻訳項目、改善計画を生成する。locale/ ディレクトリを持つプロジェクトで使用する。
---

# i18n 翻訳状況分析

## 概要

プロジェクトの国際化（i18n）状況を分析し、翻訳カバレッジレポートと改善計画を生成する。

## ワークフロー

```
1. locale/ ディレクトリの .po ファイル検出
   ↓
2. 各言語の翻訳状況を分析
   ↓
3. 優先度付け
   ↓
4. 改善計画の策定
   ↓
5. レポート出力
```

## 対応フレームワーク

- **Django**: `locale/[lang]/LC_MESSAGES/django.po`
- **Flask (Babel)**: `translations/[lang]/LC_MESSAGES/messages.po`
- **gettext**: 標準的な `.po` ファイル構造

## 処理手順

### Step 1: .po ファイル検出

1. プロジェクトルートから `locale/` または `translations/` を検索
2. 各言語ディレクトリを特定
3. `.po` ファイルを列挙

### Step 2: 翻訳状況分析

各 `.po` ファイルについて:

1. **総エントリ数**: msgid の総数
2. **翻訳済み**: msgstr が空でないエントリ
3. **未翻訳**: msgstr が空のエントリ
4. **Fuzzy**: `#, fuzzy` フラグ付きエントリ（要確認）

**統計計算**:
```
翻訳率 = (翻訳済み - Fuzzy) / 総エントリ数 × 100
```

### Step 3: 優先度付け

未翻訳項目に優先度を付ける:

| 優先度 | 条件 |
|--------|------|
| 高 | UI 表示テキスト、エラーメッセージ |
| 中 | ヘルプテキスト、説明文 |
| 低 | 管理画面、デバッグメッセージ |

**判定基準**:
- ファイル出現箇所（templates/ は高優先度）
- 文字列の長さ（短い = UI、長い = 説明文）
- 既存の翻訳パターン

### Step 4: 改善計画策定

翻訳状況に応じた改善オプション:

**Option A: 手動翻訳**
- 少量の未翻訳（〜50件）
- 専門用語が多い
- 品質が重要

**Option B: 自動翻訳 + レビュー**
- 大量の未翻訳（50件〜）
- 一般的なテキスト
- Anthropic API / Google Translate API

**Option C: 段階的改善**
- 優先度高から順に対応
- スプリントごとに目標設定

### Step 5: レポート生成

## 出力フォーマット

```markdown
# i18n 翻訳状況レポート

## プロジェクト情報

- **プロジェクト**: [プロジェクト名]
- **分析日**: YYYY-MM-DD
- **対象言語**: 日本語 (ja), 英語 (en), ...

---

## 翻訳カバレッジ

| 言語 | 総数 | 翻訳済み | 未翻訳 | Fuzzy | 翻訳率 |
|------|------|---------|--------|-------|--------|
| ja | 1000 | 950 | 30 | 20 | 93% |
| en | 1000 | 600 | 350 | 50 | 55% |

---

## 未翻訳項目（優先度順）

### 高優先度

| # | msgid | 出現箇所 |
|---|-------|----------|
| 1 | "Login" | templates/auth/login.html:15 |

### 中優先度

| # | msgid | 出現箇所 |
|---|-------|----------|
| 10 | "Help text for..." | templates/help.html:42 |

---

## Fuzzy 項目（要確認）

| # | msgid | 現在の翻訳 | 出現箇所 |
|---|-------|-----------|----------|
| 1 | "Submit" | "送信する" | forms.py:28 |

---

## 改善計画

### 推奨オプション: [A/B/C]

**理由**:
- 理由1
- 理由2

### 実施ステップ

1. ステップ1
2. ステップ2

### 見積もり

- 手動翻訳: 約X時間
- 自動翻訳: 約Y分 + レビューZ時間
```

## スクリプト

`scripts/po_stats.py` を使用して .po ファイルの統計を取得できる。

## 用語集テンプレート

プロジェクト固有の用語集を作成する場合は `references/glossary-template.md` を参照。

## 注意事項

- 日本語がソース言語の場合、日本語 .po は実質不要（未翻訳扱いで問題なし）
- Fuzzy エントリは翻訳が必要な場合はフラグを削除してから翻訳
- `term.html`, `privacy.html` 等の法的文書は翻訳対象から除外を検討
