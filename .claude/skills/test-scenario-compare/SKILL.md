---
name: test-scenario-compare
description: PR や実装とテストシナリオ（CSV/スプレッドシート）を突き合わせてテストカバレッジを検証する。CSVファイルパスとPR URLまたは実装ファイルを指定して使用する。
---

# テストシナリオ突合せ

## 概要

テストシナリオ（CSV形式）と PR/実装コードを突き合わせ、テストカバレッジを検証してレポートを生成する。

## ワークフロー

```
1. テストシナリオCSV読み込み
   ↓
2. PR/実装の変更内容分析
   ↓
3. 各シナリオ項目と実装のマッピング
   ↓
4. カバレッジ評価
   ↓
5. レポート生成 → docs/
```

## 入力

以下の情報を指定:
- **テストシナリオ**: CSV ファイルパス（必須）
- **比較対象**: PR URL、PR 番号、または実装ファイル/ディレクトリ

## 処理手順

### Step 1: テストシナリオCSV読み込み

1. CSV ファイルを読み込む
2. ヘッダー行からカラム構造を把握
3. 各行をテスト項目として解析:
   - テスト番号/ID
   - テスト内容/説明
   - 期待結果
   - 前提条件（あれば）

### Step 2: PR/実装の変更内容分析

**PR の場合**:
- `gh pr view` で PR 情報取得
- `gh pr diff` で変更内容取得
- 変更ファイルと差分を把握

**実装ファイルの場合**:
- 指定されたファイル/ディレクトリを読み込み
- 関連するテストファイルも特定

### Step 3: マッピング分析

各テストシナリオ項目について:
1. 関連する実装コードを特定
2. 対応するユニットテストを検索
3. カバレッジ状態を判定

### Step 4: カバレッジ評価

各項目を以下のステータスで評価:

| ステータス | 条件 |
|-----------|------|
| ✅ 対応済み | 実装あり、テストあり |
| ⚠️ 部分対応 | 実装あり、テスト不足または暗黙的にカバー |
| ❌ 未対応 | 実装なし、またはテストなし |
| ➖ 対象外 | 今回の変更スコープ外 |

### Step 5: レポート生成

`docs/` ディレクトリに Markdown レポートを出力。

## 出力フォーマット

```markdown
# [機能名] テストカバレッジレポート

## 概要

- **対象PR/実装**: PR #XXX または [ファイル名]
- **テストシナリオ**: [CSVファイル名]
- **検証日**: YYYY-MM-DD

## カバレッジサマリー

| ステータス | 件数 | 割合 |
|-----------|------|------|
| ✅ 対応済み | X | XX% |
| ⚠️ 部分対応 | Y | YY% |
| ❌ 未対応 | Z | ZZ% |
| ➖ 対象外 | W | WW% |

---

## 詳細

### 対応済み項目

| No | テスト内容 | 対応状況 |
|----|----------|----------|
| 1 | [内容] | ✅ [対応箇所の説明] |

### 部分対応項目

| No | テスト内容 | 対応状況 | 備考 |
|----|----------|----------|------|
| 5 | [内容] | ⚠️ [状況] | [不足点] |

### 未対応項目

| No | テスト内容 | 対応状況 | 推奨アクション |
|----|----------|----------|--------------|
| 8 | [内容] | ❌ | [必要な対応] |

---

## 結論

### テストカバレッジ評価: [十分 / 要改善 / 不十分]

**理由**:
- 理由1
- 理由2

### 推奨アクション

1. アクション1
2. アクション2
```

## カバレッジ判定基準

詳細な判定基準は `references/coverage-criteria.md` を参照。

## 注意事項

- CSV のフォーマットは柔軟に対応（区切り文字、エンコーディング）
- 大規模なシナリオの場合は主要項目に焦点を当てる
- 暗黙的なカバレッジ（既存テストで間接的にカバー）も考慮する
