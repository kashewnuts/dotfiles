---
name: settings-cleanup
description: Claude設定ファイルを分析し、不要なエントリを除去して整理する
argument-hint: [--dry-run | --apply | --global]
disable-model-invocation: true
allowed-tools: Read, Write, Bash(ls:*, cp:*)
---

# Claude 設定ファイル整理

プロジェクトの `.claude/` 設定ファイルを分析し、不要なエントリを除去して整理する。

## 入力

`$ARGUMENTS`:
- `--dry-run`: 変更を適用せず、提案のみ表示（デフォルト）
- `--apply`: 変更を実際に適用
- `--global`: グローバル設定 (`~/.claude/settings.json`) も対象に含める

## 処理手順

1. **設定ファイルの読み込み**
   - `.claude/settings.json` (プロジェクト設定)
   - `.claude/settings.local.json` (ローカル設定)
   - `~/.claude/settings.json` (グローバル設定、`--global` 指定時)

2. **permissions.allow の分析**
   - 各エントリを以下のカテゴリに分類:
     - **有効**: 正常なパーミッションパターン
     - **ゴミ**: 無効なパターン（テキスト断片、数値、記号のみ）
     - **重複**: 同一または包含関係にあるパターン
     - **一時的**: 特定の日付やハッシュを含む一回限りのコマンド

3. **ゴミエントリの特定パターン**
   ```
   - 数字のみ: "160円", "12:00"
   - 区切り線: ":------------", "---"
   - 意味のないテキスト: "Left-Aligned", "some wordy text"
   - 特定日付を含む: "git log --since=2024-12-01"
   - 長すぎる引用符付き文字列
   ```

4. **プロジェクト固有 vs グローバル共通の分類**
   - **プロジェクト固有**: Docker compose コマンド、プロジェクト固有パス
   - **グローバル共通**: git, curl, gh, ruff などの汎用コマンド

5. **整理提案の生成**
   - 削除候補のリスト
   - グローバルへの移動候補
   - 統合可能なパターン（ワイルドカード化）

6. **変更の適用**（`--apply` 指定時）
   - バックアップを作成
   - 設定ファイルを更新
   - 変更サマリーを表示

## 出力フォーマット

```markdown
## 設定ファイル分析結果

### 対象ファイル
- `.claude/settings.json`: X エントリ
- `.claude/settings.local.json`: Y エントリ

---

### 削除候補（ゴミエントリ）

| エントリ | 理由 |
|----------|------|
| `Bash(160円)` | 無効なパターン（数値/テキスト断片） |
| `Bash(:------------)` | 無効なパターン（区切り線） |

---

### 重複・統合候補

| 現在のエントリ | 提案 |
|----------------|------|
| `Bash(git log:*)`, `Bash(git log --oneline:*)` | `Bash(git log:*)` に統合 |

---

### グローバル移動候補

| エントリ | 理由 |
|----------|------|
| `Bash(ruff format:*)` | 汎用 Python ツール |

---

### アクション

- **削除**: X エントリ
- **統合**: Y エントリ → Z エントリ
- **グローバル移動**: W エントリ

`/settings-cleanup --apply` で変更を適用
```

## 注意事項

- `--dry-run` がデフォルト。誤って変更を適用しないよう安全設計
- バックアップは `.claude/settings.json.bak` として保存
- hooks 設定は変更しない（プロジェクト固有のワークフローのため）
- deny リストは変更しない（セキュリティ設定のため）
